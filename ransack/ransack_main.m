clear all; close all;

% verified point and line projection with some test point: 
% https://www.wolframalpha.com/input?i=distance+between+line+y%3D2x*3+%2B+1+and+%284%2C-12%29
project_point([1; 6 + 1], [2; 12 + 1], [4; -12]);

% test our ransack function with data from homework
load("playpensample.mat");
%load("scan4.mat");
scan_data = [r .* cosd(theta), r .* sind(theta)];
scan_data = filter_by_row(scan_data, @(x) (x(1)));

%figure(); 
%scatter(scan_data(:,1), scan_data(:,2));

%[fit_seg_start, fit_seg_end, fit_inliers, fit_outliers] = sack(scan_data, 0.1, 0.12, 100);
scan_data = [15.0881    7.3589;
   14.0821    9.1450;
   13.9179    9.3877;
   12.8596   10.7905;
   12.6701   11.0139;
   11.8589   11.8589;
   11.6529   12.0669;
    1.1818   16.9007;
   -0.3516    0.7540;
   -0.3647    0.7478;
   -0.3736    0.7333;
   -0.3859    0.7258;
   -0.3975    0.7172;
   -0.4055    0.7023;
   -0.4709    0.6725;
   -0.4855    0.6682;
   -0.4995    0.6629;
  -11.3655   12.1880;
   -0.1869    0.1935;
   -0.1846    0.1846;
   -0.1827    0.1764;
   -0.1814    0.1691;
   -0.1806    0.1626;
   -0.1804    0.1568;
   -0.1800    0.1511;
   -0.1803    0.1460;
   -0.1805    0.1410;
   -0.1805    0.1360;
   -0.1812    0.1317;
   -0.1819    0.1273;
   -0.1824    0.1230;
   -0.1828    0.1187;
   -0.1840    0.1150;
   -0.1851    0.1112;
   -0.1862    0.1075;
   -0.1872    0.1037;
   -0.1881    0.1000;
   -0.1898    0.0967;
   -0.1905    0.0929;
   -0.1921    0.0896;
   -0.1937    0.0862;
   -0.1961    0.0832;
   -0.1975    0.0798;
   -0.1998    0.0767;
   -0.2020    0.0735;
   -0.2042    0.0703;
   -0.2064    0.0671;
   -0.2094    0.0640;
   -0.2124    0.0609;
   -0.2154    0.0577;
   -0.2193    0.0547;
   -0.2212    0.0511;
   -1.2771    0.1117;
   -1.2978    0.0908;
   -1.3152    0.0689;
   -1.3452    0.0470;
   -1.3768    0.0240;
   -1.4140         0;
   -1.4478   -0.0253;
   -1.4951   -0.0522;
   -1.5409   -0.0808;
   -1.5871   -0.1110;
   -1.6348   -0.1430;
   -1.6807   -0.1767;
   -1.7429   -0.2140;
   -1.8102   -0.2544;
   -0.8311   -0.5397;
   -0.8589   -0.5793;
   -0.5598   -0.9317;
   -0.5240   -0.9076;
   -0.2249   -1.6003;
   -0.1938   -1.5781;
   -0.1634   -1.5544;
   -0.1342   -1.5341;
   -0.1060   -1.5163;
   -0.0782   -1.4930;
   -0.0514   -1.4731;
   -0.0253   -1.4508;
    0.0247   -1.4138;
    0.0488   -1.3961;
    0.0722   -1.3781;
    0.0954   -1.3637;
    0.1177   -1.3459;
    0.1392   -1.3247;
    0.1601   -1.3042;
    0.1834   -1.3052;
    0.2020   -1.2751;
    0.2469   -1.2702;
    0.2690   -1.2657;
    0.2886   -1.2501;
    0.3080   -1.2352;
    0.3269   -1.2200;
    0.3456   -1.2054;
    0.3646   -1.1925;
    0.3819   -1.1755;
    0.4001   -1.1620;
    0.4179   -1.1483;
    0.4365   -1.1371;
    0.4533   -1.1219;
    0.4700   -1.1074;
    0.4873   -1.0944;
    0.5050   -1.0830;
    0.5212   -1.0687;
    0.5380   -1.0558;
    0.5549   -1.0436;
    0.5716   -1.0312;
    0.5890   -1.0202;
    0.6052   -1.0072;
    0.6211   -0.9939;
    0.6389   -0.9838;
    0.6632   -0.9832;
    0.6751   -0.9641;
    0.6942   -0.9554;
    0.7101   -0.9424;
    0.7277   -0.9314;
    0.7451   -0.9201;
    0.7611   -0.9070;
    0.7768   -0.8936;
    0.7943   -0.8821;
    0.8123   -0.8710;
    0.8280   -0.8575;
    0.8457   -0.8457;
    0.8632   -0.8336;
    0.8791   -0.8198;
    0.8970   -0.8076;
    0.9140   -0.7945;
    0.9338   -0.7836;
    0.9512   -0.7703;
    0.9700   -0.7579;
    0.9871   -0.7438;
    1.0056   -0.7306;
    1.0231   -0.7164;
    1.0239   -0.6906;
   16.3722   -4.6947;
   16.4372   -4.4043;
   16.5076   -4.1158;
  ];

[fit_segs_start, fit_segs_end] = multisack(scan_data, 0.1, 2, 1000)

figure(); hold on;
for seg=1:size(fit_segs_start,1)
    plot([fit_segs_start(seg,1), fit_segs_end(seg,1)],[fit_segs_start(seg,2), fit_segs_end(seg,2)], 'red');
end
scatter(scan_data(:,1), scan_data(:,2), 'green');

%plot_in = scatter(fit_inliers(:,1), fit_inliers(:,2), 'green');
%plot_out = scatter(fit_outliers(:,1), fit_outliers(:,2), 'red');
%plot_fit = plot([fit_seg_start(1), fit_seg_end(1)],[fit_seg_start(2), fit_seg_end(2)], 'black');
%legend([plot_in, plot_out, plot_fit], sprintf("inliers=%d",size(fit_inliers,1)),  sprintf("outliers=%d",size(fit_outliers,1)), "fit line");

